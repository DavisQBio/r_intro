---
title: "Modeling growth rates"
layout: page
output:
  md_document:
    variant: markdown
---

```{r, echo=FALSE, purl=FALSE}
knitr::opts_chunk$set(fig.cap="figure")
```

------------

> ### Learning Objectives
>
> * Work with growth rate data to explore mathematical growth models.
> * Manipulate model parameters to build intuition.

------------

As always, you can download [a script with nothing but the R code here](../scripts/E-02-growth-rate-models.R).  

## Loading the growth rate data

You can remind yourself of these data by reviewing the [previous reading](../readings/E-01-growth-rates).  Let's quickly load these data again.

```{r, eval=TRUE}
library(growthrates)
data(antibiotic)
str(antibiotic)
```


Okay, here's the same quick summary of our data that we saw before.  Let's pull
up that final plot as well.  

```{r eval=TRUE}
library(ggplot2)
ggplot(antibiotic,aes(x=time,y=value,color=factor(conc)))+geom_point()
```

Wow, these look like some pretty well-behaved data!  The replicates at the same 
antibiotic concentration are pretty similar to each other, while bacteria grown 
at increasing antibiotic concentrations show decreasing growth rates.  Trying to
build a model to include time and antibiotic concentration is a bit above our paygrade
right now.  Let's just focus on a single concentration; why not start at 0. The package
`dplyr` has some nice tools for quickly filtering data to particular subsets. Don't
forget to install it first!

```{r eval=TRUE}
library(dplyr)
antibiotic_0 <- filter(antibiotic, conc == 0)
ggplot(antibiotic_0,aes(x=time,y=value))+geom_point()
```

Okay, we have a few things to unpack.  First, we got a suprise message when we 
loaded `dplyr`.  It mentions some "objects" from other packages that are now "masked".
This is because dplyr has functions named filter, lag, and intersect, setdiff, etc.  But
functions with those names already exist in R.  So, when `dplyr` is loaded, it masks the 
other version.  Thus, when you call the function `filter()`, it will be the function 
from the `dplyr` package, not the basic function from the `stats` package. This is usually 
not a big deal, but it's something to remember if a function seems to be working oddly.

Second, we didn't define the *color* aesthetic this time.  Why not? Well, because 
we are only looking at a single concentration level, so we don't need it.

## Comparing with a theoretical model

Okay, so how do we model this? If you're currently taking BIS 23a or a similar course,
you may have learned about this in lecture.  For a refresher, this [Khan Academy page](https://www.khanacademy.org/science/biology/ecology/population-growth-and-regulation/a/exponential-logistic-growth)
has a walkthrough about modeling population growth.

The simplest model is often the best. If it fits the data well, then you can have
clear interpretations and predictions. Let's start with basic, exponential growth 
and see how it looks. Fundamentally, the exponential model is based on the assumption
that a population's growth rate is proportional the current population size. In other 
words, even though each individual reproduces at a similar rate, on average, the actual 
rate of new offspring will go up as the population increases.  For humans, there are 
many factors that make the global population growth different from exponential.  
[Our World in Data](https://ourworldindata.org/world-population-growth) has 
a nice deep dive into human population growth trends.

But for bacteria, particularly at small population sizes, the exponential model
might fit well. In mathematical terms, our assumption of proportional growth rate
can be translated into an equation as $$\frac{dN}{dt} = rN$$.  Here $$N$$ is the population
size, $$t$$ is the time variable, and $$r$$ is a parameter to represent the growth rate.
You can think of $$r$$ as a parameter that represents net growth, incorporating both births
and deaths.  If a population is decreasing, it's totally possible that $r$ could be 
negative, when births are occurring less often than deaths. To put the equation into words, the change in population as a particular moment equals the growth rate $r$ times the population size $N$.

This is not a course on differential equations. But it turns out that the solution 
to this equation is pleasantly simple: $$N(t) = e^{rt}N(0)$$. So the population at 
some time $t$ is a function of $N(0)$, the intial population, times $e^{rt}$.  So
$N(t)$ is an exponential function of $t$, hence we call this the exponential model.

But does it fit our data well? This next step will get you used to the typical way
that we visualize models in R.

##Visualizing the exponential model

To plot the function, we can generate model output by taking a vector of
time points, and applying the function to each one. It feels confusing at first,
but it's surprisingly simple to do. 

```{r,eval=TRUE}
r <- 0.57
N0 <- 0.01
antibiotic_0 <- mutate(antibiotic_0, model_output = exp(r*time)*N0)
p <- ggplot(antibiotic_0,aes(x=time,y=value))+geom_point()
p <- p + geom_line(aes(y=model_output), color = "red")
p <- p + ylim(c(0,1))
p
```

The code above might look scary, so let's walk through it.  I first updated the
dataframe `antibiotic_0`.  The `mutate()` function in `dplyr` allows you to create
a new column as a function of other columns.  So I used the time column and applied
the exponential function from above.  Note I used 0.01 as the $N(0)$, based on the 
inspection of the data.  And I used $r = 0.57$ because I explored and found that
that value of $r$ fit the data well for early time steps.

But... this model is definitely not fitting the data at later times.

#### Exploration -- model parameters

> *We got the data to fit fairly well at early time steps, but then it was 
> way off for later times. Can you find $r$ and $N(0)$ to fit the data better>
> Explore a little bit by changing the value of the varaibles $r$ and $N0$ in the
> code above, and re-running the plot.
> I suspect you won't ever find a great fit.  Why not?

Okay, our basic exponential model was not up to the task of explaining these data.
But we do know of another model (also reviewed on the [Khan](https://www.khanacademy.org/science/biology/ecology/population-growth-and-regulation/a/exponential-logistic-growth) 
page) to try.  This is called the logistic model. Instead of assuming that the population
will *always* grow at a rate proportional to population size, we now consider that 
at some point the population growth may slow down.  There may be constraints on resources
like food, water, or space that prevent neverending population growth. A first take
on this might start with our similar equation $\frac{dN}{dt} = rN$, but add a second factor
that will take $\frac{dN}{dt}$ towards 0 as $N$ reaches some maximum population size $K$.
Note: in ecology this parameter $K$ is often called the *carrying capacity*. Let's try out
this updated equation: $\frac{dN}{dt} = rN(1-\frac{N}{K})$.  Now when $N$ is much smaller than
$K$, we basically have the familiar exponential growth.  But as $N$ gets close in value to
$K$, then the term $(1-\frac{N}{K})$ gets close to 0, and population growth will slow to a halt.

This is the population *growth* that's slowing.  The population won't die out, it will just
level at a value of $K$. Okay, let's plot this.  The solution to this different equation
is more complicated. I'll get you started, but you'll need to fiddle around to find the best choices of parameters.

```{r, child="../_page_built_on.Rmd"}
```
